(function(){window.IntrovertIntegration=function(n){var e=this,s=document.location.protocol=='https:'?'https:':'http:',u=s+'//api.yadrocrm.ru',l='/js',f='/integration/site',d=3000,o='introvert_cookie',r=['utm_source','utm_medium','utm_term','utm_content','utm_campaign','city_name','country_name','refer','ip'],a=['roistat_visit','_ga','_ym_uid'],t,c,i;this.simple=!1;this.params={};this.$=!1;this.protocol=s;this.key=n;this.settings={};this.Cookies={};this._settings={url:u+f+'?key='+n,sendVisit:!1,disableSubmit:!1,useLocalStorage:!1};this.includeJQueryScript=function(n){if(!window.jQuery||!window.jQuery.fn.on){var o=!1;if(!!window.jQuery&&!window.jQuery.fn.on){o=!0};var i=document.createElement('script');i.type='text/javascript';i.src=s+'//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js';document.getElementsByTagName('head')[0].appendChild(i);if(i.readyState){i.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){if(o){t=window.jQuery.noConflict(!0)}
else{window.jQuery.noConflict();t=window.jQuery};e.$=t;c=t(document);n()}}}
else{i.onload=function(){if(o){t=window.jQuery.noConflict(!0)}
else{window.jQuery.noConflict();t=window.jQuery};e.$=t;c=t(document);n()}}}
else{t=window.jQuery;e.$=t;c=t(document);n()}};this.includeCookieScript=function(t){if(i){t()}
else if(window.Cookies){i=window.Cookies;e.Cookies=i;t()}
else{var n=document.createElement('script');n.type='text/javascript';n.src=u+l+'/cookie.js';document.getElementsByTagName('head')[0].appendChild(n);if(n.readyState){n.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){i=window.Cookies;t()}}}
else{n.onload=function(){i=window.Cookies;e.Cookies=i;t()}}}};this.bindActions=function(){if(!e.settings.disableSubmit){c.on('submit','form',e.getHandler({handlerBefore:e.settings.handlerBefore,handlerAfter:e.settings.handlerAfter}))};if(e.settings.events){try{t.each(e.settings.events,function(n,i){var o=i.type.match(/([^,\s]+)/g);t.each(o,function(n,o){if(i.target){t(i.target).on(o,i.element,e.getHandler(i));if(e.$.fn.jquery!=jQuery.fn.jquery&&o.search(/[^\w]/)!=-1){jQuery(i.target).on(o,i.element,e.getHandler(i))}}
else{e.$(document).on(o,i.element,e.getHandler(i));if(e.$.fn.jquery!=jQuery.fn.jquery&&o.search(/[^\w]/)!=-1){jQuery(document).on(o,i.element,e.getHandler(i))}}})})}catch(n){console.log(n)}}};this.getHandler=function(n,i,o){return function(s){var r=!1;if(n.form==='this'||!n.form){if(n.target){r=t(this)}
else{r=t(s.target)}}
else if(typeof n.form=='object'){r=n.form}
else{r=t(n.form)};if(!r){return!0};if(e.checkHasPassword(r)){console.log('form was excluded because has password');console.log(r);return!0};if(typeof i==='function'){i(r)};if(typeof n.handlerBefore==='function'){if(n.handlerBefore(r)===!1){return!0}};if(e.checkExcluded(r)){console.log('form was excluded');console.log(r);return!0};var c=e.getParams();r.find(':input').each(function(){var e=t(this);if(e.attr('name')){if((e.attr('type')=='radio'||e.attr('type')=='checkbox')&&!e.is(':checked')){return!0};c[e.attr('name')]=e.val()}});if(e.settings.params){try{t.each(e.settings.params,function(e,n){if(n&&t.isArray(n)&&n[0].form){t.each(n,function(n,i){if(r.is(t(i.form))){c[e]=i.value;return!1}})}
else{c[e]=n}})}catch(a){console.log(a)}};if(n.params){t.each(n.params,function(e,t){c[e]=t})};if(typeof o==='function'){o(c)};if(typeof n.handlerAfter==='function'){if(n.handlerAfter(c,r)===!1){return!0}};e.send(e.settings.url,c)}};this.getParams=function(){var t=e.getCookies();try{if(Ya){t['_ya']=Ya._metrika.counter.getClientID()}}catch(n){};t['user_agent']=window.navigator.userAgent;t['user_language']=window.navigator.language;t['screen_size']=window.screen.width+'x'+window.screen.height;t['page_url']=window.location.toString();t['site']=window.location.hostname;t['page_title']=document.title;return t};this.sendVisit=function(){if(e.settings.sendVisit&&e.settings.visitHandlerUrl){if(e.settings.visitPages&&e.settings.visitPages.length>0){var o=window.location.pathname+window.location.search,n=!1;t.each(e.settings.visitPages,function(e,t){if(t.test(o)){n=!0;return!1}});if(!n){return!1}};var i=e.getParams();e.send(e.settings.visitHandlerUrl,i,e.settings.visitCallback)}};this.send=function(e,i,o,r){e=e||u+f+'?key='+n;var s=!1,a=new Date().getTime();t(window).on('beforeunload',function(){});t.ajax({url:e,data:i,dataType:'json',async:!0,timeout:d,method:'post'}).always(function(){s=!0}).done(function(e){if(typeof o=='function'){o(e)}})};this.getCookies=function(){var s,t,r;try{if(e.settings.useLocalStorage===!0&&typeof localStorage!=='undefined'){s=JSON.parse(localStorage.getItem(o))||{}}
else{s=i.getJSON(o)||{}}}catch(n){console.log(n);s={}};for(r=0;r<a.length;r++){t=i.get(a[r]);try{if(a[r]=='_ga'){t=t.split('.');t=t[2]+'.'+t[3];s['clid']=t}
else{s[a[r]]=t}}catch(n){}};return s};this.setCookies=function(){var n=e.getUrlParameters();for(var t=0;t<r.length;t++){if(n[r[t]]){e.params[r[t]]=n[r[t]]};if(!e.params.refer){e.params.refer=document.referrer}};e.getGeoParams().done(function(){if(e.settings.useLocalStorage&&typeof localStorage!=='undefined'){try{localStorage.setItem(o,JSON.stringify(e.params));i.set(o,'')}catch(t){console.log(t)}}
else{i.set(o,e.params,{expires:365})}})};this.getGeoParams=function(){var i=t.Deferred();if(!e.params.city_name||e.params.city_name=='unknown'){try{e.getUserData(function(t){try{if(t){e.params.ip=t.ip?t.ip:'unknown';e.params.city_name=t.city?t.city.name_ru:'unknown';e.params.country_name=t.country?t.country.name_ru:'unknown';i.resolve()}}catch(n){i.resolve()}})}catch(n){i.resolve()}}
else{i.resolve()};return i.promise()};this.getUserData=function(e){t.ajax({url:s+'//api.sypexgeo.net/',dataType:'json'}).done(function(t){if(typeof e=='function'){e(t)}})};this.getUrlParameters=function(){var o=decodeURIComponent(window.location.search.substring(1)),n=o.split('&'),i={};for(var e=0;e<n.length;e++){var t=n[e].split('=');i[t[0]]=t[1]};return i};this.bootstrap=function(){var i=0,n=[e.includeJQueryScript,e.includeCookieScript],o=function(){i++;if(i==n.length){e.init()}};for(var t=0;n.length>t;t++){n[t](o)}};this.beforeInit=function(e){};this.afterInit=function(e){};this.setSettings=function(n){n=n||{};t.each(n,function(t,n){e.settings[t]=n})};this.init=function(){if(typeof window.introvert_settings=='function'){window.introvert_settings(e)};t.each(e.settings,function(t,n){e._settings[t]=n});e.settings=e._settings;e.params=e.getParams();e.setCookies();e.sendVisit();if(t.isReady){if(!e.simple){e.beforeInit(t);e.bindActions();e.afterInit(t)};console.log('introvert init')}
else{t(function(){if(!e.simple){e.beforeInit(t);e.bindActions();e.afterInit(t)};console.log('introvert init')})}};this.checkHasPassword=function(n){if(n.find('input[type="password"]').length>0){if(e.settings.force){var i=!1;t.each(e.settings.force,function(e,o){if(n.is(t(o))){i=!0;return!1}});if(i==!1){return!0}}
else{return!0}};return!1};this.checkExcluded=function(n){if(e.settings.excludedForms){var i=!1;t.each(e.settings.excludedForms,function(o,s){if(n.is(t(s))){if(e.settings.force){var r=!1;t.each(e.settings.force,function(e,i){if(n.is(t(i))){r=!0;return!1}});if(r==!1){i=!0;return!1}}
else{i=!0;return!1}}});if(i){return!0}};return!1};this.getForms=function(){var n={included:{},excluded:[]};t.each(e.settings.events,function(i,o){var s={};if(o.target){s=t(o.target+' '+o.element)}
else{s=t(o.element)};s.each(function(){var i=this,s=t(i);if(e.checkHasPassword(s)||e.checkExcluded(s)){n.excluded.push(i)}
else{n.included[o.type]=n.included[o.type]||{};n.included[o.type][o.element]=n.included[o.type][o.element]||[];n.included[o.type][o.element].push(i)}})});if(!e.settings.disableSubmit){t('form').each(function(){var i=this,o=t(i);if(e.checkHasPassword(o)||e.checkExcluded(o)){n.excluded.push(i)}
else{n.included.submit=n.included.submit||{};n.included.submit.other=n.included.submit.other||{};n.included.submit.other[Object.keys(n.included.submit.other).length]=i}})};console.log(n)};e.bootstrap()};if(typeof window.introvert_callback=='function'){window.introvert_callback();delete window.introvert_callback}})();function introvert_settings(e){e.simple=!0;e.setSettings({disableSubmit:!0})};